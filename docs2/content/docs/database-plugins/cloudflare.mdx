---
title: "Cloudflare D1 Database"
description: Use cloudflare database with hot-updater
icon: cloudflare
---

# Cloudflare D1 Database

Store your Hot Updater bundle metadata in Cloudflare D1, a serverless SQLite database running at the edge.

## Installation

```package-install
npm install @hot-updater/cloudflare --save-dev
```

## Configuration

```typescript
interface D1DatabaseConfig {
  databaseId: string;           // D1 database ID
  accountId: string;            // Cloudflare account ID
  cloudflareApiToken: string;   // Cloudflare API token
}
```

## Usage

```typescript
import { d1Database } from '@hot-updater/cloudflare';
import { defineConfig } from 'hot-updater';

export default defineConfig({
  database: d1Database({
    databaseId: process.env.D1_DATABASE_ID,
    accountId: process.env.CLOUDFLARE_ACCOUNT_ID,
    cloudflareApiToken: process.env.CLOUDFLARE_API_TOKEN
  }),
  // ... other config
});
```

## Setup

1. Create a D1 database in Cloudflare dashboard
2. Generate an API token with D1 edit permissions
3. Note your database ID and account ID
4. Run SQL migrations to create tables

## Database Schema

The plugin uses a snake_case schema compatible with SQLite. Check the package's SQL directory for migration scripts.

## Key Features

- Serverless SQLite at the edge
- Global distribution via Cloudflare network
- Optimized SQL queries with pg-minify
- Uses Cloudflare SDK for API operations

## Environment Variables

```bash
D1_DATABASE_ID=your-d1-database-id
CLOUDFLARE_ACCOUNT_ID=your-account-id
CLOUDFLARE_API_TOKEN=your-api-token
```

## Complete Example

Combined R2 storage and D1 database:

```typescript
import { d1Database } from '@hot-updater/cloudflare';
import { s3Storage } from '@hot-updater/aws';
import { defineConfig } from 'hot-updater';

export default defineConfig({
  storage: s3Storage({
    region: 'auto',
    endpoint: `https://${process.env.CLOUDFLARE_ACCOUNT_ID}.r2.cloudflarestorage.com`,
    credentials: {
      accessKeyId: process.env.R2_ACCESS_KEY_ID,
      secretAccessKey: process.env.R2_SECRET_ACCESS_KEY
    },
    bucketName: 'my-r2-bucket'
  }),
  database: d1Database({
    databaseId: process.env.D1_DATABASE_ID,
    accountId: process.env.CLOUDFLARE_ACCOUNT_ID,
    cloudflareApiToken: process.env.CLOUDFLARE_API_TOKEN
  }),
  // ... other config
});
```
